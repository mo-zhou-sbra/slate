<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Softbank Robotics NAOqi API Documentation *working progress*</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;python&quot;,&quot;c++&quot;,&quot;android&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="c++">c++</a>
              <a href="#" data-language-name="android">android</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://developer.softbankrobotics.com/'>Developer Portal</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<blockquote>
<p>In all following code examples, make sure to replace the IP address in default to your robot IP, or execute the python script with an &ndash;ip argument.
If running on robot (Packaged and Installed) use the local Naoqi IP address indicated below.</p>
</blockquote>

<p>Welcome to NAOqi API Tutorial. We are excited to start building awesome applications on our robots. The pre-requisite to use the APIs can be found <a href='http://doc.aldebaran.com/2-5/dev/python/install_guide.html'> here </a> and we assume you have installed the Python SDKs with paths added. If you choose a different programming language to Python, please also add the SDK for that specific language of your choice.</p>

<h1 id="quick-start">Quick Start</h1>

<h2 id="make-pepper-listen-and-speak">Make Pepper Listen and Speak</h2>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="c"># Get the service ALSpeechRecognition.</span>
    <span class="n">asr_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">"ALSpeechRecognition"</span><span class="p">)</span>
    <span class="n">asr_service</span><span class="o">.</span><span class="n">setLanguage</span><span class="p">(</span><span class="s">"English"</span><span class="p">)</span>
    <span class="c"># Example: Adds "yes", "no" and "please" to the vocabulary (without wordspotting)</span>
    <span class="n">vocabulary</span> <span class="o">=</span> <span class="p">[</span><span class="s">"yes"</span><span class="p">,</span> <span class="s">"no"</span><span class="p">,</span> <span class="s">"please"</span><span class="p">]</span>
    <span class="n">asr_service</span><span class="o">.</span><span class="n">setVocabulary</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="c">#You can say the above words to see reaction</span>
    <span class="c"># Start the speech recognition engine with user Test_ASR</span>
    <span class="n">asr_service</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"Test_ASR"</span><span class="p">)</span>
    <span class="c"># Get the service ALTextToSpeech.</span>
    <span class="n">tts</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">"ALTextToSpeech"</span><span class="p">)</span>
    <span class="c">#Says a test std::string</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Hello, speech recognition engine started"</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="c">#unsubscribe</span>
    <span class="n">asr_service</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="s">"Test_ASR"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--ip"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"10.80.129.90"</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Robot IP address. On robot or Local Naoqi: use '127.0.0.1'."</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--port"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">9559</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Naoqi port number"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"tcp://"</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">RuntimeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"Can't connect to Naoqi at ip </span><span class="se">\"</span><span class="s">"</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">"</span><span class="se">\"</span><span class="s"> on port "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span><span class="s">".</span><span class="se">\n</span><span class="s">"</span>
               <span class="s">"Please check your script arguments. Run with -h option for help."</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</code></pre>
<p>This example uses both the ALSpeechRecognition (ASR) and ALTextToSpeech (TTS) API Modules.
It starts the speech recognition engine with a few words added to the dictionary,
and makes the robot say some text using the TTS module.</p>

<p>ASR module gives to the robot the ability to recognize predefined words or phrases in several languages, and relies on sophisticated speech recognition technologies provided by NUANCE.</p>

<p>Before starting, ALSpeechRecognition needs to be fed by the list of phrases that should be recognized. Once started, ALSpeechRecognition places in the key SpeechDetected, a boolean that specifies if a speaker is currently heard or not. If a speaker is heard, the element of the list that best matches what is heard by the robot is placed in the key WordRecognized. If a speaker is heard, the element of the list that best matches what is heard by the robot is placed in the key WordRecognizedAndGrammar.</p>

<p>TTS module allows the robot to speak. It sends commands to a text-to-speech engine, and authorizes also voice customization. The result of the synthesis is sent to the robot’s loudspeakers.</p>

<p>In this example, we have added &ldquo;yes&rdquo;, &ldquo;no&rdquo; and &ldquo;please&rdquo; to the vocabulary so you can test the reaction by saying &ldquo;yes&rdquo;, &ldquo;no&rdquo; or &ldquo;please&rdquo;. Pepper should respond by saying &ldquo;Hello, speech recognition engine started&rdquo; if the speech recognition works.</p>

<p>You can find more about the ALTextToSpeech API Module  <a href='http://doc.aldebaran.com/2-5/naoqi/audio/altexttospeech-api.html#altexttospeech-api'>here</a> and ALSpeechRecognition API Module <a href='http://doc.aldebaran.com/2-5/naoqi/audio/alspeechrecognition-api.html?highlight=alspeechre#ALSpeechRecognitionProxy'>here</a>.</p>

<h2 id="have-a-conversation-with-pepper">Have a Conversation with Pepper</h2>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="c"># Getting the service ALDialog</span>
    <span class="n">ALDialog</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">"ALDialog"</span><span class="p">)</span>
    <span class="n">ALDialog</span><span class="o">.</span><span class="n">setLanguage</span><span class="p">(</span><span class="s">"English"</span><span class="p">)</span>
    <span class="c"># writing topics' qichat code as text strings (end-of-line characters are important!)</span>
    <span class="c"># You could put the topic in a separate file and load it using the absolute path</span>
    <span class="n">topic_content_1</span> <span class="o">=</span> <span class="p">(</span><span class="s">'topic: ~example_topic_content()</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'language: enu</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'concept:(food) [fruits chicken beef eggs]</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'u: (I [want "would like"] {some} _~food) Sure! You must really like $1 .</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'u: (how are you today) Hello human, I am fine thank you and you?</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'u: (Good morning Nao did you sleep well) No damn! You forgot to switch me off!</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'u: ([e:FrontTactilTouched e:MiddleTactilTouched e:RearTactilTouched]) You touched my head!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">topic_content_2</span> <span class="o">=</span> <span class="p">(</span><span class="s">'topic: ~dummy_topic()</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'language: enu</span><span class="se">\n</span><span class="s">'</span>
                       <span class="s">'u:(test) [a b "c d" "e f g"]</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="c"># Loading the topics directly as text strings</span>
    <span class="n">topic_name_1</span> <span class="o">=</span> <span class="n">ALDialog</span><span class="o">.</span><span class="n">loadTopicContent</span><span class="p">(</span><span class="n">topic_content_1</span><span class="p">)</span>
    <span class="n">topic_name_2</span> <span class="o">=</span> <span class="n">ALDialog</span><span class="o">.</span><span class="n">loadTopicContent</span><span class="p">(</span><span class="n">topic_content_2</span><span class="p">)</span>
    <span class="c"># Activating the loaded topics</span>
    <span class="n">ALDialog</span><span class="o">.</span><span class="n">activateTopic</span><span class="p">(</span><span class="n">topic_name_1</span><span class="p">)</span>
    <span class="n">ALDialog</span><span class="o">.</span><span class="n">activateTopic</span><span class="p">(</span><span class="n">topic_name_2</span><span class="p">)</span>
    <span class="c"># Starting the dialog engine - we need to type an arbitrary string as the identifier</span>
    <span class="c"># We subscribe only ONCE, regardless of the number of topics we have activated</span>
    <span class="n">ALDialog</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">'my_dialog_example'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">raw_input</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Speak to the robot using rules from both the activated topics. Press Enter when finished:"</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c"># stopping the dialog engine</span>
        <span class="n">ALDialog</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="s">'my_dialog_example'</span><span class="p">)</span>
        <span class="c"># Deactivating all topics</span>
        <span class="n">ALDialog</span><span class="o">.</span><span class="n">deactivateTopic</span><span class="p">(</span><span class="n">topic_name_1</span><span class="p">)</span>
        <span class="n">ALDialog</span><span class="o">.</span><span class="n">deactivateTopic</span><span class="p">(</span><span class="n">topic_name_2</span><span class="p">)</span>
        <span class="c"># now that the dialog engine is stopped and there are no more activated topics,</span>
        <span class="c"># we can unload all topics and free the associated memory</span>
        <span class="n">ALDialog</span><span class="o">.</span><span class="n">unloadTopic</span><span class="p">(</span><span class="n">topic_name_1</span><span class="p">)</span>
        <span class="n">ALDialog</span><span class="o">.</span><span class="n">unloadTopic</span><span class="p">(</span><span class="n">topic_name_2</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--ip"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"10.80.129.90"</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Robot's IP address. If on a robot or a local Naoqi - use '127.0.0.1' (this is the default value)."</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--port"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">9559</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"port number, the default value is OK in most cases"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"tcp://{}:{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">RuntimeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Can't connect to Naoqi at IP {} (port {}).</span><span class="se">\n</span><span class="s">Please check your script's arguments."</span>
               <span class="s">" Run with -h option for help.</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</code></pre>
<p>This example sets up a topic following the QiChat syntax, you could also load the topic in a .top file on the robot.</p>

<p>The ALDialog module allows you to endow your robot with conversational skills by using a list of “rules” written and categorized in an appropriate way.</p>

<h3 id="rules">Rules</h3>

<p>ALDialog uses a list of written rules in order to manage the flow of the conversation between the human and the robot.</p>

<p>These rules are of two types: User rules and Proposal rules.</p>

<p>A User rule links a specific user input to possible robot output.
<aside class="notice">
u: (Hello Nao how are you today) Hello human, I am fine thank you and you?
</aside></p>

<p>A Proposal rule triggers a specific robot output without any user output beforehand.
<aside class="notice">
proposal: Have you seen that guy on the TV yesterday?
   u1: (yes) He was crazy, no?
   u1: (no) Really, I need to tell you.
</aside></p>

<h3 id="grouped-by-topics">Grouped by Topics</h3>

<p>In order to properly manage the conversation between the human and the robot, the rules are grouped by Topics.</p>

<aside class="notice">
topic: ~greetings
language: enu

u: (Hello Nao how are you today) Hello human, I am fine thank you and you?
u: ({&ldquo;Good morning&rdquo;} {Nao} did you sleep * well) No damn! You forgot to switch me off!
proposal: human, are you going well ?
   u1: (yes) I&rsquo;m so happy!
   u1: (no) I&rsquo;m so sad
</aside>

<h3 id="collaborative-dialog-vs-applications">Collaborative dialog vs applications</h3>

<p>We can differentiate three steps in robot life: autonomous life, collaborative dialog (interactive state) and your application. Collaborative dialog allows running your application by voice. You can simply add trigger sentences in the manifest of your application or add more advanced dialog.</p>

<aside class="notice">
topic: ~startmyweather
language: enu

include: lexicon_enu.top

u: (start weather) are you sure?
u1: (~yes) ok ^switchFocus(myweather/.)
</aside>

<p>Find more about QiChat rules <a href='http://doc.aldebaran.com/2-5/naoqi/interaction/dialog/aldialog_syntax_toc.html'>here</a></p>

<h2 id="make-pepper-play-an-animation">Make Pepper Play an Animation</h2>
<pre class="highlight python tab-python"><code>
<span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="c"># Get the service ALAnimationPlayer.</span>
    <span class="n">animation_player_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">"ALAnimationPlayer"</span><span class="p">)</span>
    <span class="c"># play an animation, this will return when the animation is finished</span>
    <span class="n">animation_player_service</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">"animations/Stand/Gestures/Hey_1"</span><span class="p">)</span>
    <span class="c"># play an animation, this will return right away</span>
    <span class="n">future</span> <span class="o">=</span> <span class="n">animation_player_service</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">"animations/Stand/Gestures/Hey_1"</span><span class="p">,</span> <span class="n">_async</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># wait the end of the animation</span>
    <span class="n">future</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
    <span class="c"># play an animation, this will return right away</span>
    <span class="n">future</span> <span class="o">=</span> <span class="n">animation_player_service</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">"animations/Stand/Gestures/Hey_1"</span><span class="p">,</span> <span class="n">_async</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># stop the animation</span>
    <span class="n">future</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--ip"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"10.80.129.90"</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Robot IP address. On robot or Local Naoqi: use '127.0.0.1'."</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--port"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">9559</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Naoqi port number"</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"tcp://"</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">RuntimeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"Can't connect to Naoqi at ip </span><span class="se">\"</span><span class="s">"</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">"</span><span class="se">\"</span><span class="s"> on port "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span><span class="s">".</span><span class="se">\n</span><span class="s">"</span>
               <span class="s">"Please check your script arguments. Run with -h option for help."</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</code></pre>
<p>ALAnimationPlayer allows you to start animations. This module is a wrapper of ALBehaviorManager, its goal is to have an easy way to start animations according to animation tags or the current posture of the robot.</p>

<h3 id="animation-paths">Animation Paths</h3>

<p>To run an application stored in a package, use: package_name/path_of_animation</p>

<p>Start, stop or wait an animation. You can check out more prebuilt animations
<a href='http://doc.aldebaran.com/2-5/naoqi/motion/alanimationplayer-advanced.html#animationplayer-list-behaviors-pepper'>here </a></p>

<p>Or, You can also use your own behaviors provided that you follow these requirements:</p>

<p>Limit the content of the behavior to an animation (no speech, no complex behaviors), in order to guaranty a good compatibility with ALTextToSpeech.
Lock the resources as follow: Wait 1 second at box startup, and lock resources during box execution - in order to secure a full compatibility with the automatic body language process.</p>

<h3 id="tags">Tags</h3>

<p>You can use any tag supplied by default. For further details, see <a href='http://doc.aldebaran.com/2-5/naoqi/motion/alanimationplayer-advanced.html#animationplayer-tags-pepper'>
</a> here</p>

<p>Additionally, you can declare new tagged animations using: ALAnimationPlayer.declarePathForTags</p>

<p>You can also declare new tags for some specific animations (without modifying the animations) using: ALAnimationPlayer.addTagForAnimations</p>

<h2 id="make-pepper-recognize-emotion">Make Pepper Recognize Emotion</h2>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>

    <span class="s">"""
    1st example uses the currentPersonState method.
    """</span>
    <span class="c"># Get the service ALMood.</span>
    <span class="n">moodService</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">"ALMood"</span><span class="p">)</span>
    <span class="n">tts</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">"ALTextToSpeech"</span><span class="p">)</span>
    <span class="n">valence</span> <span class="o">=</span> <span class="n">moodService</span><span class="o">.</span><span class="n">currentPersonState</span><span class="p">()[</span><span class="s">"valence"</span><span class="p">][</span><span class="s">"value"</span><span class="p">]</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"your current state is "</span> <span class="o">+</span> <span class="n">valence</span><span class="p">)</span>

    <span class="s">"""
    2nd example uses the getEmotionalReaction method.
    """</span>
    <span class="c"># Get the services ALMood and ALTextToSpeech.</span>

    <span class="c"># The robot tries to provocate an emotion by greeting you</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"Hey, you! Look at me. I'll tell you what your emotion is!"</span><span class="p">)</span>
    <span class="c"># The robot will try to analysis your reaction during the next 3 seconds</span>
    <span class="n">emotion</span> <span class="o">=</span> <span class="n">moodService</span><span class="o">.</span><span class="n">getEmotionalReaction</span><span class="p">()</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="s">"You reaction is"</span> <span class="o">+</span> <span class="n">emotion</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--ip"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"10.80.129.90"</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Robot IP address. On robot or Local Naoqi: use '127.0.0.1'."</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--port"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">9559</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">"Naoqi port number"</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"tcp://"</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">RuntimeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">"Can't connect to Naoqi at ip </span><span class="se">\"</span><span class="s">"</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">"</span><span class="se">\"</span><span class="s"> on port "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span><span class="s">".</span><span class="se">\n</span><span class="s">"</span>
               <span class="s">"Please check your script arguments. Run with -h option for help."</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</code></pre>
<p>ALMood works by estimating the mood of the focused user, provided by ALUserSession. The first example is how to get current valence and the second example is to get emotional reaction after a provocation.</p>

<p>ALMood’s estimation of valence (i.e. positivity or negativity) builds upon various extractors and memory keys; in particular, it currently uses head angles from ALGazeAnalysis, expressions properties and smile information from ALFaceCharacteristics, acoustic voice emotion analysis from ALVoiceEmotionAnalysis and semantic information from the words spoken by the user.</p>

<p>The calculation of high-level keys takes into account the observation at a given moment, the previous emotional state and the ambient and social context (e.g. noisy environment, smile too long, user profile).</p>

<p>All emotional key values are associated with a confidence score between 0 and 1 to indicate how likely an estimation is.</p>

<h3 id="basic-emotions">Basic Emotions</h3>

<p>You can query for a basic emotional reaction over 3 seconds.</p>

<p>The analysis starts when the method ALMood::getEmotionalReaction is called.
<aside class = "notice">
An emotional reaction value can be:
“positive”
“neutral”
“negative”
“unknown”
</aside></p>

<h3 id="emotional-descriptors">Emotional descriptors</h3>

<p>Person emotion:
The following descriptors provide mood data about the focused user.
<aside class = "notice">
Valence: whether the person’s mood is positive or negative.
Attention: the amount of attention the focused person gives to the robot.
Ambiance:
</aside></p>

<p>Excitement/Agitation: indicates the activity level of the environment, whether it’s calm or excited.</p>

<h1 id="advanced-topics">Advanced Topics</h1>

<h2 id="create-a-service">Create a Service</h2>

<p>A service is a background process. It is always running and advertises : <br>
- Methods <br>
- Signals <br>
- Properties <br></p>

<h2 id="qi-framework">qi Framework</h2>
<pre class="highlight python tab-python"><code><span class="c">#service example</span>
<span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">class</span> <span class="nc">ServiceSample</span><span class="p">:</span>
    <span class="n">services_connected</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">connected_signals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">number_of_activities_launched</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">application</span><span class="p">):</span>
        <span class="c"># Getting a session that will be reused everywhere</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span> <span class="o">=</span> <span class="n">application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="n">session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activities_launched</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>

        <span class="c"># Getting a logger. Logs will be in /var/log/naoqi/servicemanager/{application id}.{service name}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">service_name</span><span class="p">)</span>

        <span class="c"># Do some initializations before the service is registered to NAOqi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Initializing..."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_services</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Initialized!"</span><span class="p">)</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">start_service</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Starting..."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe_to_autonomous_life</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Started!"</span><span class="p">)</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">stop_service</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># probably useless, unless one method needs to stop the service from inside.</span>
        <span class="c"># external naoqi scripts should use ALServiceManager.stopService if they need to stop it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Stopping service..."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Stopped!"</span><span class="p">)</span>

    <span class="nd">@qi.bind</span><span class="p">(</span><span class="n">methodName</span><span class="o">=</span><span class="s">"getNumberActivitiesLaunched"</span><span class="p">,</span> <span class="n">paramsType</span><span class="o">=</span><span class="p">(),</span> <span class="n">returnType</span><span class="o">=</span><span class="n">qi</span><span class="o">.</span><span class="n">Int32</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_number_activities_launched</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_activities_launched</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">connect_services</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># connect all services required by your module</span>
        <span class="c"># done in async way over 30s,</span>
        <span class="c"># so it works even if other services are not yet ready when you start your module</span>
        <span class="c"># this is required when the service is autorun as it may start before other modules...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Connecting services...'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">services_connected</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Promise</span><span class="p">()</span>
        <span class="n">services_connected_fut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">services_connected</span><span class="o">.</span><span class="n">future</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">get_services</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">'ALMemory'</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">life</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">'ALAutonomousLife'</span><span class="p">)</span>
                <span class="c"># connect other services if needed...</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'All services are now connected'</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">services_connected</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'Still missing some service:</span><span class="se">\n</span><span class="s"> {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="n">get_services_task</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">PeriodicTask</span><span class="p">()</span>
        <span class="n">get_services_task</span><span class="o">.</span><span class="n">setCallback</span><span class="p">(</span><span class="n">get_services</span><span class="p">)</span>
        <span class="n">get_services_task</span><span class="o">.</span><span class="n">setUsPeriod</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">))</span>  <span class="c"># check every 2s</span>
        <span class="n">get_services_task</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">services_connected_fut</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c"># timeout = 30s</span>
            <span class="n">get_services_task</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">RuntimeError</span><span class="p">:</span>
            <span class="n">get_services_task</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">'Failed to reach all services after 30 seconds'</span><span class="p">)</span>
            <span class="k">raise</span> <span class="nb">RuntimeError</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">subscribe_to_autonomous_life</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_memory_subscriber</span><span class="p">(</span><span class="s">"AutonomousLife/FocusedActivity"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_focused_activity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_memory_subscriber</span><span class="p">(</span><span class="s">"AutonomousLife/State"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_state_changed</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">on_focused_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"FocusedActivity signal raised: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">activity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"New focused activity: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_activities_launched</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activities_launched</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_activities_launched</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Number of activities focused since last activation: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_activities_launched</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Just going back to IDLE, discard"</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">on_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"State signal raised: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s">"disabled"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"AutonomousLife disabled, resetting count"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_activities_launched</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activities_launched</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"AutonomousLife is changing state but remains activated"</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">add_memory_subscriber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="c"># add memory subscriber utility function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Subscribing to {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">subscriber</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connected_signals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">sub</span><span class="p">,</span> <span class="n">con</span><span class="p">])</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Error while subscribing: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">remove_memory_subscribers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># remove memory subscribers utility function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"unsubscribing to all signals..."</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_signals</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sub</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Error while unsubscribing: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="nd">@qi.nobind</span>
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># called when your module is stopped</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Cleaning..."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_memory_subscribers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"End!"</span><span class="p">)</span>

    <span class="c"># ################# #</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c"># with this you can run the script for tests on remote robots</span>
    <span class="c"># run : python my_super_service.py --qi-url 123.123.123.123</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">service_instance</span> <span class="o">=</span> <span class="n">ServiceSample</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">service_id</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">registerService</span><span class="p">(</span><span class="n">service_instance</span><span class="o">.</span><span class="n">service_name</span><span class="p">,</span> <span class="n">service_instance</span><span class="p">)</span>
    <span class="n">service_instance</span><span class="o">.</span><span class="n">start_service</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">service_instance</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">unregisterService</span><span class="p">(</span><span class="n">service_id</span><span class="p">)</span>

</code></pre>
<h3 id="qi-application-api">qi.Application API</h3>

<p>Application initializes the qi framework, it extract –qi-* commandline arguments and initialise various options accordingly. It also provides facilities to connect the main session. This ease the creation of console applications that connects to a session or want to be standalone.</p>

<p>You can pass the following arguments to your application to control the session:</p>

<p>–qi-url : address of the session to connect to
–qi-listen-url : address on which the session will listen
–qi-standalone : make a standalone session (use –qi-listen-url to set the listen url)
By default the session url is set to “tcp://127.0.0.1:9559” and the listen url to “tcp://0.0.0.0:0”.</p>

<p>If raw is specified there wont be a session embedded into the application and you are free to create and connect a session yourself if needed.</p>

<p>if autoExit is set to True, a session disconnection will quit the program. Set autoExit to False to inhibit this behavior. By default autoExit is True.</p>

<p>Application will parse your arguments and catch –qi-* arguments.</p>

<p>For a normal application you have to call start to let the Session embedded into the application connect. If you want to handle –help yourself you can do that before the application starts avoiding a useless connection to the session.</p>

<h3 id="qi-session-api">qi.Session API</h3>

<p>A session connect to a standalone qi.Session. Once connected the session can:</p>

<p>advertise new services using qi.Session.registerService()
get services using qi.Session.service()</p>

<h3 id="qi-future-api">qi.Future API</h3>

<p>Promise and Future are a way to synchronise data between multiples threads. The number of future associated to a promise is not limited. Promise is the setter, future is the getter. Basically, you have a task to do, that will return a value, you give it a Promise. Then you have others thread that depend on the result of that task, you give them future associated to that promise, the future will block until the value or an error is set by the promise.</p>

<h3 id="qi-signal-api">qi.Signal API</h3>

<p>Signal allows communication between threads. One thread emits events, other threads register callback to the signal, and process the events appropriately.</p>

<h3 id="bind-api">Bind API</h3>

<p>qi.bind allow specifying types for bound methods. By default methods parameters are of type AnyValue and always return an AnyValue.</p>

<p>With qi.bind you can specify which types the function really accept and return. With qi.nobind you can hide methods.</p>

<h3 id="using-qicli-commands">Using qicli commands</h3>

<p>qicli commands allows you to:</p>

<ol>
<li>See information</li>
<li>Use methods</li>
<li>Watch signals</li>
</ol>

<p>You can either run a service remotely from your computer, or you can run it on the robot locally. Change the IP to your robot IP address.
<aside class = "notice">
python service_sample.py &ndash;qi-url 10.80.127.123
</aside></p>

<p>To access the robot with SSH, use this code. You&rsquo;ll need to authenticate with your password.
Then you can use qicli commands.</p>

<aside class = "notice"> <b>Use secure shell to access the robot </b> <br>
ssh nao@10.80.127.123 <br>
<b>Then you can access the qicli commands</b> <br>
qicli info <br>
qicli info ALSystem <br>
qicli call ALTextToSpeech.say Hello <br>
</aside>

<h2 id="find-the-logs">Find the Logs</h2>

<p>System:
tail -f /var/log/naoqi/servicemanager/system.Naoqi.log
tail -f /var/log/naoqi/servicemanager/system.Naoqi_error.log</p>

<p>Services:
tail -f /var/log/naoqi/servicemanager/<app-uuid>.<service-name>.log
tail -f /var/log/naoqi/servicemanager/<app-uuid>.<service-name>_error.log</p>

<h2 id="sample-robot-application">Sample Robot Application</h2>

<p>Controller :    Service written in python <br>
Tablet:         Webpage written in HTML + Javascript <br>
Dialog:         Qichat <br></p>

<p>Here is a color app which demonstrates the MVC (Model View Controller) architecture of our robot application. <a href="https://github.com/softbank-robotics-america/API-Tutorial/blob/master/working-Color-App.zip" download>Download the Color App on GitHub</a></p>

<p>→ Expose a method to be called by Javascript</p>

<p>→ Subscribe to the events raised by the QiChat</p>

<p>→ Communicate back to the tablet to change the background’s color</p>

          <h1 id="errors">Errors</h1>

<p>Common errors with NAOqi API:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
</tbody></table>

<p><em>examples of error</em></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="c++">c++</a>
                <a href="#" data-language-name="android">android</a>
          </div>
      </div>
    </div>
  </body>
</html>
